dist: bionic
os: linux
language: python
services:
  - docker
branches:
  only:
    - master
    - develop
env:
  DOCKER_COMPOSE_VERSION: 1.25.4
  IMAGE_NAME: flask-tdd-docker
  GITLAB_REGISTRY_IMAGE: registry.gitlab.com
  HEROKU_REGISTRY_IMAGE: registry.heroku.com/$HEROKU_APP_NAME/web

# the following line is needed to enable the TravisCI build conditions
conditions: v1

stages:
  - name: Docker Compose Tests
    if: type = pull_request

jobs:
  include:
    - stage: Docker Compose Tests
      before_install: |
        sudo rm /usr/local/bin/docker-compose;
        curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose;
        chmod +x docker-compose;
        sudo mv docker-compose /usr/local/bin;
      before_script: |
        rm Dockerfile;
        cp Dockerfile.travis Dockerfile;
        rm Dockerfile.travis;
        docker-compose up -d --build;
        docker-compose stop;
        docker-compose down;
      script:
        echo "no test!";
